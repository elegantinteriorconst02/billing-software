<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vendor & Item Master</title>

<link rel="stylesheet" href="../assets/menu.css">

<style>
body{
  font-family:Arial;
  background:#f4f6fb;
  padding:20px;
}

h2{margin-bottom:12px}

.grid{
  display:grid;
  grid-template-columns:300px 360px 1fr;
  gap:20px;
}

.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.card h3{
  margin:0 0 10px;
  font-size:16px;
}

input,textarea,select,button{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  border-radius:8px;
  border:1px solid #ccc;
}

textarea{resize:vertical}

button{
  background:#2d6cdf;
  color:#fff;
  border:none;
  cursor:pointer;
}
button:hover{background:#1f4fd8}

table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:8px;
  border-bottom:1px solid #eee;
  font-size:14px;
}
th{background:#f1f3f9}

.badge{
  background:#e8f0ff;
  color:#1f4fd8;
  padding:4px 8px;
  border-radius:12px;
  font-size:12px;
}

.right{text-align:right}
</style>
</head>

<body>

<div id="menu-holder"></div>

<h2>üè≠ Vendor & Item Master</h2>

<div class="grid">

<!-- VENDOR LIST -->
<div class="card">
  <h3>üìã Vendor List</h3>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>GST</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="vendorTable"></tbody>
  </table>
</div>

<!-- VENDOR FORM -->
<div class="card">
  <h3>Vendor Details</h3>

  <input type="hidden" id="vendorId">

  <input id="vName" placeholder="Vendor Name *">
  <input id="vPhone" placeholder="Phone">
  <input id="vEmail" placeholder="Email">
  <input id="vGst" placeholder="GSTIN">
  <input id="vState" placeholder="State">
  <input id="vPin" placeholder="PIN Code">

  <textarea id="vAddress" placeholder="Address"></textarea>
  <textarea id="vRemarks" placeholder="Remarks"></textarea>

  <button onclick="saveVendorUI()">üíæ Save Vendor</button>
</div>

<!-- ITEMS -->
<div class="card">
  <h3>Vendor Items</h3>

  <input id="itemName" placeholder="Item name">
  <input id="itemRate" type="number" placeholder="Rate">
  <input id="itemGst" type="number" placeholder="GST %">

  <select id="itemUom">
    <option>PCS</option>
    <option>NOS</option>
    <option>KG</option>
    <option>LITRE</option>
  </select>

  <button onclick="addItem()">‚ûï Add Item</button>

  <table>
    <thead>
      <tr>
        <th>Item</th>
        <th>UOM</th>
        <th>GST%</th>
        <th class="right">Rate</th>
        <th>X</th>
      </tr>
    </thead>
    <tbody id="itemTable"></tbody>
  </table>
</div>

</div>

<!-- SCRIPTS -->
<script src="../data/storage.js"></script>
<script src="../data/recyclebin.js"></script>
<script src="../data/vendor.js"></script>
<script src="../data/vendor-items.js"></script>

<script>
const vendorTable = document.getElementById("vendorTable");
const itemTable   = document.getElementById("itemTable");

/* ===== RENDER VENDORS ===== */
function renderVendors(){
  vendorTable.innerHTML = "";
  getVendors().forEach(v=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${v.name}</td>
      <td>${v.gst || "-"}</td>
      <td>
        <button onclick="editVendor('${v.id}')">‚úè</button>
        <button onclick="removeVendor('${v.id}')" style="background:#dc3545">üóë</button>
      </td>
    `;
    vendorTable.appendChild(tr);
  });
}

/* ===== SAVE / UPDATE ===== */
function saveVendorUI(){
  if(!vName.value) return alert("Vendor name required");

  const data = {
    id: vendorId.value || undefined,
    name: vName.value,
    phone: vPhone.value,
    email: vEmail.value,
    gst: vGst.value,
    state: vState.value,
    pin: vPin.value,
    address: vAddress.value,
    remarks: vRemarks.value
  };

  if(data.id){
    updateVendor(data);
  }else{
    saveVendor(data);
  }

  clearVendorForm();
  renderVendors();
}

/* ===== EDIT ===== */
function editVendor(id){
  const v = getVendor(id);
  if(!v) return;

  vendorId.value = v.id;
  vName.value = v.name || "";
  vPhone.value = v.phone || "";
  vEmail.value = v.email || "";
  vGst.value = v.gst || "";
  vState.value = v.state || "";
  vPin.value = v.pin || "";
  vAddress.value = v.address || "";
  vRemarks.value = v.remarks || "";

  loadItems(id);
}

/* ===== DELETE (‚Üí RECYCLE BIN) ===== */
function removeVendor(id){
  if(confirm("Delete vendor?")){
    deleteVendor(id);
    clearVendorForm();
    renderVendors();
    itemTable.innerHTML = "";
  }
}

function clearVendorForm(){
  vendorId.value = "";
  vName.value = "";
  vPhone.value = "";
  vEmail.value = "";
  vGst.value = "";
  vState.value = "";
  vPin.value = "";
  vAddress.value = "";
  vRemarks.value = "";
}

/* ===== ITEMS ===== */
function loadItems(vendorId){
  itemTable.innerHTML = "";
  getItemsByVendor(vendorId).forEach(i=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i.name}</td>
      <td><span class="badge">${i.uom}</span></td>
      <td>${i.gst}%</td>
      <td class="right">‚Çπ ${i.rate}</td>
      <td><button onclick="delItem('${i.id}')">‚úï</button></td>
    `;
    itemTable.appendChild(tr);
  });
}

function addItem(){
  if(!vendorId.value) return alert("Select vendor first");
  if(!itemName.value) return alert("Item name required");

  saveVendorItem({
    vendorId: vendorId.value,
    name: itemName.value,
    rate: Number(itemRate.value||0),
    gst: Number(itemGst.value||0),
    uom: itemUom.value
  });

  itemName.value="";
  itemRate.value="";
  itemGst.value="";

  loadItems(vendorId.value);
}

function delItem(id){
  if(confirm("Delete item?")){
    deleteVendorItem(id);
    loadItems(vendorId.value);
  }
}

renderVendors();
</script>

<script src="../shared/menu.js"></script>
<script>
fetch("../shared/menu.html")
  .then(r=>r.text())
  .then(html=>{
    document.getElementById("menu-holder").innerHTML = html;
    initMenu();
  });
</script>

</body>
</html>
