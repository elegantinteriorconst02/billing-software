<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Vendor & Item Master</title>

<link rel="stylesheet" href="../assets/menu.css">

<style>
body{
  font-family:Arial;
  background:#f4f6fb;
  padding:20px;
}

h2{margin-bottom:12px}

.grid{
  display:grid;
  grid-template-columns:280px 1fr;
  gap:20px;
}

.card{
  background:#fff;
  border-radius:16px;
  padding:16px;
  box-shadow:0 10px 25px rgba(0,0,0,.08);
}

.card h3{
  margin:0 0 10px;
  font-size:15px;
  color:#444;
}

input,select,button{
  width:100%;
  padding:8px;
  margin-bottom:8px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:14px;
}

button{
  background:#2d6cdf;
  color:#fff;
  border:none;
  cursor:pointer;
}

button:hover{background:#1f4fd8}

table{
  width:100%;
  border-collapse:collapse;
  font-size:14px;
}

th,td{
  border-bottom:1px solid #eee;
  padding:8px;
  text-align:left;
}

th{background:#f1f3f9}

.badge{
  background:#e8f0ff;
  color:#1f4fd8;
  padding:4px 8px;
  border-radius:12px;
  font-size:12px;
}

.flex{display:flex;gap:10px;flex-wrap:wrap}

.right{text-align:right}

.small{font-size:12px;color:#666}
</style>
</head>

<body>
    <h2>Vendor Master</h2>

<div id="menu-holder"></div>

<h2>üè≠ Vendor & Item Master</h2>

<div class="grid">

<!-- VENDOR LIST -->
<div class="card">
  <h3>üìã Vendor List</h3>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Phone</th>
        <th>GST</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="vendorTable"></tbody>
  </table>
</div>



  <!-- LEFT : VENDOR -->
  <div class="card">
    <h3>Vendor</h3>

    <select id="vendorSelect"></select>

<input id="vName" placeholder="Vendor Name *">
<input id="vPhone" placeholder="Phone">
<input id="vEmail" placeholder="Email">
<input id="vGst" placeholder="GSTIN">
<input id="vState" placeholder="State">
<input id="vPin" placeholder="PIN Code">

<textarea id="vAddress" placeholder="Address"></textarea>
<textarea id="vRemarks" placeholder="Remarks"></textarea>


    <button onclick="addVendor()">‚ûï Add Vendor</button>



    <div class="small">
  Select vendor to edit details or manage items
</div>
  </div>
  <div class="small">
  <b>Vendor GST:</b> <span id="vGstView"></span><br>
  <b>Phone:</b> <span id="vPhoneView"></span>
</div>

  <!-- RIGHT : ITEMS -->
  <div class="card">
    <h3>Vendor Items</h3>

    <div class="flex">
      <input type="hidden" id="vendorId">
      <input id="itemName" placeholder="Item name">
      <input id="itemRate" type="number" placeholder="Rate">
      <input id="itemGst" type="number" placeholder="GST %">
      <select id="itemUom">
        <option>PCS</option><option>NOS</option><option>SET</option>
        <option>KG</option><option>LITRE</option>
      </select>
    </div>
    <button
  id="deleteVendorBtn"
  style="background:#dc3545;display:none"
  onclick="removeVendor()"
>
üóë Delete Vendor
</button>


    <button onclick="addItem()">‚ûï Add Item</button>

    <br>

    <table>
      <thead>
        <tr>
          <th>Item</th>
          <th>UOM</th>
          <th>GST%</th>
          <th class="right">Rate ‚Çπ</th>
          <th>X</th>
        </tr>
      </thead>
      <tbody id="itemTable"></tbody>
    </table>
  </div>

</div>

<!-- SCRIPTS -->
<script src="../data/vendor.js"></script>
<script src="../data/vendor-items.js"></script>

<script>
/* ===== LOAD VENDORS ===== */
const vendorSelect = document.getElementById("vendorSelect");
const itemTable = document.getElementById("itemTable");

function loadVendors(){
  const list = getVendors();
  vendorSelect.innerHTML = "<option value=''>-- Select Vendor --</option>";
  list.forEach(v=>{
    const o = document.createElement("option");
    o.value = v.id;
    o.textContent = v.name;
    vendorSelect.appendChild(o);
  });
}
function removeVendor(){
  const vid = vendorSelect.value;
  if(!vid) return;

  if(confirm("Delete this vendor?")){
    deleteVendor(vid);
    vendorSelect.value = "";
    itemTable.innerHTML = "";
    loadVendors();
  }
}
const vendorTable = document.getElementById("vendorTable");

function renderVendorTable(){
  const list = getVendors();
  vendorTable.innerHTML = "";

  list.forEach(v=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td><b>${v.name}</b></td>
      <td>${v.phone || ""}</td>
      <td>${v.gst || "-"}</td>
      <td>
        <button onclick="editVendor('${v.id}')">‚úè Edit</button>
        <button onclick="deleteVendorUI('${v.id}')" style="background:#dc3545">üóë</button>
      </td>
    `;
    vendorTable.appendChild(tr);
  });
}

function editVendor(id){
  const v = getVendor(id);
  if(!v) return;

  vendorSelect.value = v.id;

  vName.value    = v.name || "";
  vPhone.value   = v.phone || "";
  vEmail.value   = v.email || "";
  vGst.value     = v.gst || "";
  vState.value   = v.state || "";
  vPin.value     = v.pin || "";
  vAddress.value = v.address || "";
  vRemarks.value = v.remarks || "";

  loadItems();
}

function deleteVendorUI(id){
  if(confirm("Delete this vendor?")){
    deleteVendor(id);
    renderVendorTable();
    loadVendors();
    itemTable.innerHTML = "";
  }
}
renderVendorTable();
loadVendors();

vendorSelect.onchange = ()=>{
  const v = getVendor(vendorSelect.value);
  if(!v) return;

  vName.value    = v.name || "";
  vPhone.value   = v.phone || "";
  vEmail.value   = v.email || "";
  vGst.value     = v.gst || "";
  vState.value   = v.state || "";
  vPin.value     = v.pin || "";
  vAddress.value = v.address || "";
  vRemarks.value = v.remarks || "";

  vGstView.innerText = v.gst || "-";
  vPhoneView.innerText = v.phone || "-";

  loadItems();
};

/* ===== ADD VENDOR ===== */
function addVendor(){
  if(!vName.value) return alert("Enter vendor name");

  saveVendor({
  name: vName.value,
  gst: vGst.value,
  phone: vPhone.value,
  email: vEmail.value,
  address: vAddress.value,
  state: vState.value,
  pin: vPin.value,
  remarks: vRemarks.value
  });

 vName.value="";
  vGst.value="";
  vPhone.value="";
  vEmail.value="";
  vAddress.value="";
  vRemarks.value="";

  loadVendors();
  renderVendorTable();
}

/* ===== ITEMS ===== */
function loadItems(){
  const vid = vendorSelect.value;
  itemTable.innerHTML = "";
  if(!vid) return;

  getItemsByVendor(vid).forEach(i=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${i.name}</td>
      <td><span class="badge">${i.uom}</span></td>
      <td>${i.gst}%</td>
      <td class="right">‚Çπ ${i.rate}</td>
      <td><button onclick="delItem('${i.id}')">‚úï</button></td>
    `;
    itemTable.appendChild(tr);
  });
}

function addItem(){
  if(!vendorSelect.value) return alert("Select vendor first");
  if(!itemName.value) return alert("Enter item name");

  saveVendorItem({
    vendorId: vendorSelect.value,
    name: itemName.value,
    rate: Number(itemRate.value||0),
    gst: Number(itemGst.value||0),
    uom: itemUom.value
  });

  itemName.value="";
  itemRate.value="";
  itemGst.value="";
  loadItems();
}

function delItem(id){
  if(confirm("Delete item?")){
    deleteVendorItem(id);
    loadItems();
  }
}

/* INIT */
loadVendors();
</script>

<script src="../shared/menu.js"></script>
<script>
fetch("../shared/menu.html")
  .then(r=>r.text())
  .then(html=>{
    document.getElementById("menu-holder").innerHTML = html;
    initMenu();
  });


</script>

</body>
</html>
