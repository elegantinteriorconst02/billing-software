<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Billing / Quotation</title>

<link rel="stylesheet" href="assets/menu.css">

<style>
body{font-family:Arial;}
h2{margin-bottom:6px}
hr{margin:12px 0}
table{border-collapse:collapse;width:100%}

/* PRINT */
#printTitle{display:none;}
@media print{
  #printTitle{display:block;text-align:center;font-size:18px;font-weight:bold}
  .actions,.controls,button{display:none!important;}
  table{font-size:12px}
}

th,td{border:1px solid #888;padding:6px;font-size:13px}
th{background:#eee;text-align:center}

input,select,textarea{font-size:13px;padding:4px}
textarea{resize:none;overflow:hidden}

.flex{display:flex;gap:10px;flex-wrap:wrap}
.block{border:1px solid #aaa;padding:8px;min-width:280px;flex:1}
.hide{display:none}
.summary{margin-top:15px}
.sl{width:40px;text-align:center;font-weight:bold}
</style>

<script>
if(!localStorage.getItem("user")){
  location.href="login.html";
}
</script>
</head>

<body>

<!-- MENU -->
<div id="menuContainer"></div>

<!-- MAIN -->
<div class="main">

<h2 id="printTitle">Billing / Quotation</h2>

<!-- COMPANY HEADER -->
<div id="companyHeader" style="text-align:center;margin-bottom:15px">
  <img id="logoImg" style="max-height:140px;display:block;margin:auto">
  <h2 id="companyName"></h2>
  <div id="companyAddr"></div>
  <div id="companyContact"></div>
  <div id="companyTax"></div>
</div>

<!-- DOC INFO -->
<div class="flex">
  <div>
    <b>Document Type:</b>
    <select id="docType">
      <option>TAX-INVOICE</option>
      <option>Quotation</option>
      <option>Proforma Invoice</option>
    </select>
  </div>

  <div><b>No:</b><input id="docNo"></div>
  <div><b>Date:</b><input type="date" id="docDate"></div>

  <div>
    <b>Tax Type:</b>
    <select id="taxType">
      <option value="intra">CGST + SGST</option>
      <option value="inter">IGST</option>
    </select>
  </div>
</div>

<hr>

<!-- BILL / SHIP -->
<div class="flex">
<div class="block">
<b>Bill To</b><br>
<input list="clientList" id="billName"><br>
<textarea id="billAddr" oninput="autoResize(this)"></textarea><br>
<input id="billMob"><br>
<input id="billEmail"><br>
</div>

<div class="block">
<b>Ship To</b><br>
<input id="shipName"><br>
<textarea id="shipAddr" oninput="autoResize(this)"></textarea>
</div>
</div>

<hr>

<!-- TABLE -->
<table>
<thead>
<tr>
<th>SL</th><th>Desc</th><th>Qty</th><th>Rate</th><th>Taxable</th><th>GST%</th><th>Net</th><th>X</th>
</tr>
</thead>
<tbody id="tbody"></tbody>
</table>

<br>
<button onclick="addRow()">+ Add Row</button>

<!-- SUMMARY -->
<div class="summary">
<b>Grand Total: â‚¹ <span id="grand">0.00</span></b><br>
<b>In Words:</b> <span id="inWords"></span>
</div>

<hr>

<div class="actions">
  <button onclick="openPrint()">ðŸ–¨ Print</button>
</div>

</div>
<!-- END MAIN -->

<!-- DATA -->
<datalist id="clientList"></datalist>

<!-- SCRIPTS (UNCHANGED LOGIC) -->
<script src="data/storage.js"></script>
<script src="data/bills.js"></script>

<script>
function autoResize(el){
  el.style.height="auto";
  el.style.height=el.scrollHeight+"px";
}

function addRow(){
  const tr=document.createElement("tr");
  tr.innerHTML=`
    <td class="sl"></td>
    <td><textarea></textarea></td>
    <td><input type="number" value="1"></td>
    <td><input type="number" value="0"></td>
    <td class="taxable">0</td>
    <td><input type="number" value="18"></td>
    <td class="net">0</td>
    <td><button onclick="this.closest('tr').remove();calc()">âœ•</button></td>
  `;
  tr.querySelectorAll("input,textarea").forEach(e=>e.oninput=calc);
  tbody.appendChild(tr);
  updateSL();
  calc();
}

function updateSL(){
  document.querySelectorAll("#tbody tr").forEach((tr,i)=>{
    tr.querySelector(".sl").innerText=i+1;
  });
}

function calc(){
  let total=0;
  document.querySelectorAll("#tbody tr").forEach(tr=>{
    const qty=+tr.children[2].querySelector("input").value||0;
    const rate=+tr.children[3].querySelector("input").value||0;
    const gst=+tr.children[5].querySelector("input").value||0;
    const base=qty*rate;
    const net=base+(base*gst/100);
    tr.querySelector(".taxable").innerText=base.toFixed(2);
    tr.querySelector(".net").innerText=net.toFixed(2);
    total+=net;
  });
  grand.innerText=Math.round(total);
  inWords.innerText=numberToWords(Math.round(total));
}

function numberToWords(num){
  return "Rupees "+num+" Only";
}

addRow();
</script>

<!-- MENU LOAD -->
<script src="shared/menu.js"></script>
<script>
fetch("shared/menu.html")
.then(r=>r.text())
.then(html=>{
  menuContainer.innerHTML=html;
  initMenu();
});
</script>

</body>
</html>
